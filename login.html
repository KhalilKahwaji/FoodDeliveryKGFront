<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Login</title>
 
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="login.css">
    
    <!--Stylesheet-->


</head>
<body>
    <div class="background">
        <div class="shape"></div>
        <div class="shape"></div>
    <div>
        <form >
            <h3>Login Here</h3>
    
            <label for="username">Username</label>
            <input type="text" placeholder="Username" id="username">
    
            <label for="password">Password</label>
            <input type="password" placeholder="Password" id="password">
            <p class="message">Show Password<input   type="checkbox" id="showpasscheckbox" style="height: 15px;" onclick="myFunction()"></p>
            
            <div>
              <p class="message">New Customer? <a href="customerRegister.html">Create an account</a></p>
              <p class="message">New Restaurant? <a href="restauRegister.html">Create an account</a></p>
            </div>
           
           
        </form>
        
        <button type="button" onclick="submit()" style="position: absolute; top:95%; background-color:rgb(50, 52, 61); color:rgb(255, 255, 255);">Login</button> 
    </div>

   
    <script type="text/javascript">
        function submit() {

            if(document.getElementById('username').value==""){

                alert("please enter username");

            }else if(document.getElementById('password').value==""){

                alert("please enter password");

            }else{
                var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 3) {
                    if(xhr.response!= "[]"){
                        alert("logging in...")
                        login(xhr.response);
                    }else{
                        alert("wrong username or password")

                    }
                
                }
            }
            var str="http://localhost:5236/api/Users/";
            str+= document.getElementById('username').value;
            str+="/";
            str+= document.getElementById('password').value;

            xhr.open('get', str, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            xhr.send();
            }
           
            
        }
    

        function login(info) {

            var myObj= JSON.parse(info);
            //alert(myObj[0].userid);
            
            
            /*
[
  {
    "userid": 2,
    "fname": "khalil",
    "lname": "kahwaji",
    "username": "mkkhell",
    "dateCreated": "2022-07-16T00:00:00",
    "password": "123",
    "phoneNumber": 70707070,
    "address": "zahle"
  },*/


            var userid= myObj[0].userid;
            var fname= myObj[0].fname;
            var lname= myObj[0].lname;
            var dateCreated= myObj[0].dateCreated;
            var phoneNumber= myObj[0].phoneNumber;
            var address= myObj[0].address;
            var username= myObj[0].username;

           
            sessionStorage.setItem("userid", userid);
            sessionStorage.setItem("fname", fname);
            sessionStorage.setItem("lname", lname);
            sessionStorage.setItem("dateCreated", dateCreated);
            sessionStorage.setItem("phoneNumber", phoneNumber);
            sessionStorage.setItem("address", address);
            sessionStorage.setItem("username", username);



             

            window.location.href = "index.html";  

        }
    </script>
</body>
</html>
<script>
    function myFunction() {
    var x = document.getElementById("password");
    var cbox= document.getElementById("showpasscheckbox");
    
    if (cbox.checked ) {
         x.type = "text";
       
    } else {
         x.type = "password";
         
            }
 
    }
    </script>